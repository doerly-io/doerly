<div class="chat-window-container">
  <p-progressSpinner *ngIf="loading()" styleClass="custom-spinner"></p-progressSpinner>

  <div *ngIf="!loading() && !conversationId()" class="no-selection">
    <p>{{'communication.choose_conversation' | translate}}</p>
    <i class="pi pi-comments"></i>
  </div>

  <div *ngIf="!loading() && conversationId() && !conversation()" class="no-conversation">
    <p>{{'communication.conversation_not_found' | translate}}</p>
  </div>

  <!-- Chat -->
  <div *ngIf="!loading() && conversation()" class="chat-content">
    <!-- Header -->
    <div class="chat-header">
      <p-avatar *ngIf="getRecipientImageUrl()" [image]="getRecipientImageUrl()!" shape="circle" size="large"></p-avatar>
      <h2>{{ getRecipientName() }}</h2>
    </div>

    <!-- Messages list -->
    <div #messageContainer class="chat-messages">
      <div
        *ngFor="let message of conversation()!.messages; trackBy: trackByMessageId"
        class="message"
        [ngClass]="{'own-message': isOwnMessage(message), 'other-message': !isOwnMessage(message)}"
      >
        <div class="message-content">
          <p>{{ message.messageContent }}</p>
          <small>{{ message.sentAt | date: 'shortTime' }}</small>
        </div>
      </div>
      <div class="no-messages" *ngIf="!conversation()?.messages?.length">
        <p>{{'communication.no_messages_yet' | translate}}</p>
      </div>
      <div class="typing-indicator" *ngIf="typingUser()">
        <p>{{ typingUser() }} {{'communication.typing' | translate}}</p>
      </div>
    </div>

    <!-- Input field -->
    <div class="chat-input">
      <input
        pInputText
        type="text"
        [value]="message() || ''"
        (input)="updateMessageText($event)"
        (keyup.enter)="message() && sendMessage()"
        placeholder="{{'communication.message_placeholder' | translate}}"
        class="message-input"
      />
      <button
        pButton
        type="button"
        [disabled]="!message()"
        (click)="sendMessage()"
        icon="pi pi-send"
        class="send-button p-button-rounded"
      ></button>
    </div>
  </div>

  <p-toast></p-toast>
</div>
