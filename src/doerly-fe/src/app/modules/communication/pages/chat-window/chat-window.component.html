<div class="chat-window-container">
  <!-- Індикатор завантаження -->
  <p-progressSpinner *ngIf="loading()" styleClass="custom-spinner"></p-progressSpinner>

  <!-- Якщо бесіда не обрана -->
  <div *ngIf="!loading() && !conversationId()" class="no-selection">
    <p>Оберіть бесіду, щоб почати спілкування</p>
    <i class="pi pi-comments"></i>
  </div>

  <!-- Якщо розмову не знайдено -->
  <div *ngIf="!loading() && conversationId() && !conversation()" class="no-conversation">
    <p>Розмову не знайдено</p>
  </div>

  <!-- Чат -->
  <div *ngIf="!loading() && conversation()" class="chat-content">
    <!-- Хедер -->
    <div class="chat-header">
      <p-avatar *ngIf="getRecipientImageUrl()" [image]="getRecipientImageUrl()!" shape="circle" size="large"></p-avatar>
      <h2>{{ getRecipientName() }}</h2>
    </div>

    <!-- Список повідомлень -->
    <div #messageContainer class="chat-messages">
      <div
        *ngFor="let message of conversation()!.messages; trackBy: trackByMessageId"
        class="message"
        [ngClass]="{'own-message': isOwnMessage(message), 'other-message': !isOwnMessage(message)}"
      >
        <div class="message-content">
          <p>{{ message.messageContent }}</p>
          <small>{{ message.sentAt | date: 'shortTime' }}</small>
        </div>
      </div>
      <div class="no-messages" *ngIf="!conversation()?.messages?.length">
        <p>Повідомлень ще немає</p>
      </div>
    </div>

    <!-- Поле вводу -->
    <div class="chat-input">
      <input
        pInputText
        type="text"
        [value]="message() || ''"
        (input)="updateMessageText($event)"
        (keyup.enter)="message() && sendMessage()"
        placeholder="Напишіть повідомлення..."
        class="message-input"
      />
      <button
        pButton
        type="button"
        [disabled]="!message()"
        (click)="sendMessage()"
        icon="pi pi-send"
        class="send-button p-button-rounded"
      ></button>
    </div>
  </div>

  <p-toast></p-toast>
</div>
